# NACOS(1.3.0)
# 注册中心
## 两种协议(raft distro)
### distro
> 用于构建AP系统(高可用，分区容错性)
#### 协议讲解
##### distro协议主要思想：
如果集群有两台机器，那么使用实例名称与namespace拼出一个唯一名称，计算出hash值，逻辑与实例数量，如果计算出改实例为本机负责，那么则在本机存储该实例的信息，并且异步同步至其他nacos集群的机器，如果不是本机处理，那么直接由本机调用远程应该处理该实例的机器，进行实例存储，远程机器也会同步实例信息至其他机器，这样通过存储同步实现一个AP协议
### distro
> 用于构建CP系统(一致性，分区容错性)
#### raft协议的主要思想:
首先raft分为2种角色
- leader
1. 处理读写请求
2. 同步数据至其他机器
3. 心跳至其他机器，压制其他机器选举
- fllower
1. 处理读请求
>这里读请求可以分为两种情况，一种是不保证强一致性(即直接取出对应数据)，还有一种是先跟leader确认当前信息是否是最新的，如果是则返回，如果不是，则失败
2. 发起选举
> 一段时间内如果没有收到leader的心跳，或者同步信息，则认为leader已经死亡，则发起选举

具体的raft协议可以参考 https://github.com/maemual/raft-zh_cn/blob/master/raft-zh_cn.md

## 实例注册
- 如果实例为持久性实例(客户端定义)，那么就使用CP走raft，实现一致性
- 如果实例为非持久性实例，那么就使用AP走distro，实现高可用

我们可以看到nacos其实是一种混合模式，根据实例的不同属性，放入不同的容器，走不同的同步方式

## 配置中心
 - TODO